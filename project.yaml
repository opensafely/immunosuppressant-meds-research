version: '3.0'

expectations:
  population_size: 50000

actions:

  generate_study_population:
    run: cohortextractor:latest generate_cohort --study-definition study_definition
    outputs:
      highly_sensitive:
        cohort: output/input.csv

  create_cohorts:
    run: stata-mp:latest analysis/000_define_covariates.do
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        log1: logs/start_create_analysis_dataset.smcl 
        data1: output/data/file_imid.dta
        data2: output/data/file_joint.dta
        data3: output/data/file_skin.dta
        data4: output/data/file_bowel.dta
        data5: output/data/file_imiddrugcategory.dta
        data6: output/data/file_standtnf.dta
        data7: output/data/file_standtnf3m.dta
        data8: output/data/file_tnfmono.dta
        data9: output/data/file_standil6.dta
        data10: output/data/file_standil17.dta
        data11: output/data/file_standil23.dta
        data12: output/data/file_standjaki.dta
        data13: output/data/file_standritux.dta
        data14: output/data/file_standinflix.dta
        data15: output/data/file_standvedolizumab.dta
        data16: output/data/file_standabatacept.dta

  create_cohorts_single_file:
    run: stata-mp:latest analysis/001_define_covariates_single_file.do
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        log1: logs/start_create_analysis_dataset_single_file.smcl 
        data1: output/data/file_imid_all.dta

  run_baseline_tables:
    run: stata-mp:latest analysis/100_baseline_characteristics.do
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/descriptive_tables.smcl 
      
  run_cox_models_imid:
    run: stata-mp:latest analysis/202_cox_models.do "imid"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_imid.smcl 
        data1: output/data/cox_model_summary_imid.dta
        data2: output/data/cox_model_summary_haemonc_imid.dta
        
  run_cox_models_joint:
    run: stata-mp:latest analysis/202_cox_models.do "joint"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_joint.smcl 
        data1: output/data/cox_model_summary_joint.dta
        data2: output/data/cox_model_summary_haemonc_joint.dta

  run_cox_models_skin:
    run: stata-mp:latest analysis/202_cox_models.do "skin"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_skin.smcl 
        data1: output/data/cox_model_summary_skin.dta
        data2: output/data/cox_model_summary_haemonc_skin.dta
 
  run_cox_models_bowel:
    run: stata-mp:latest analysis/202_cox_models.do "bowel"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_bowel.smcl 
        data1: output/data/cox_model_summary_bowel.dta
        data2: output/data/cox_model_summary_haemonc_bowel.dta
 
  run_cox_models_imiddrugcategory:
    run: stata-mp:latest analysis/202_cox_models.do "imiddrugcategory"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_imiddrugcategory.smcl 
        data1: output/data/cox_model_summary_imiddrugcategory.dta
        data2: output/data/cox_model_summary_haemonc_imiddrugcategory.dta
  
  run_cox_models_standtnf:
    run: stata-mp:latest analysis/202_cox_models.do "standtnf"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_standtnf.smcl 
        data1: output/data/cox_model_summary_standtnf.dta
        data2: output/data/cox_model_summary_haemonc_standtnf.dta

  run_cox_models_standtnf3m:
    run: stata-mp:latest analysis/202_cox_models.do "standtnf3m"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_standtnf3m.smcl 
        data1: output/data/cox_model_summary_standtnf3m.dta
        data2: output/data/cox_model_summary_haemonc_standtnf3m.dta
       
  run_cox_models_tnfmono:
    run: stata-mp:latest analysis/202_cox_models.do "tnfmono"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_tnfmono.smcl 
        data1: output/data/cox_model_summary_tnfmono.dta
        data2: output/data/cox_model_summary_haemonc_tnfmono.dta
  
  run_cox_models_standil6:
    run: stata-mp:latest analysis/202_cox_models.do "standil6"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_standil6.smcl 
        data1: output/data/cox_model_summary_standil6.dta
        data2: output/data/cox_model_summary_haemonc_standil6.dta
  
  run_cox_models_standil17:
    run: stata-mp:latest analysis/202_cox_models.do "standil17"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_standil17.smcl 
        data1: output/data/cox_model_summary_standil17.dta
        data2: output/data/cox_model_summary_haemonc_standil17.dta
 
  run_cox_models_standil23:
    run: stata-mp:latest analysis/202_cox_models.do "standil23"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_standil23.smcl 
        data1: output/data/cox_model_summary_standil23.dta
        data2: output/data/cox_model_summary_haemonc_standil23.dta
 
  run_cox_models_standjaki:
    run: stata-mp:latest analysis/202_cox_models.do "standjaki"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_standjaki.smcl 
        data1: output/data/cox_model_summary_standjaki.dta
        data2: output/data/cox_model_summary_haemonc_standjaki.dta
  
  run_cox_models_standritux:
    run: stata-mp:latest analysis/202_cox_models.do "standritux"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_standritux.smcl 
        data1: output/data/cox_model_summary_standritux.dta
        data2: output/data/cox_model_summary_haemonc_standritux.dta
        
  run_cox_models_standinflix:
    run: stata-mp:latest analysis/202_cox_models.do "standinflix"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_standinflix.smcl 
        data1: output/data/cox_model_summary_standinflix.dta
        data2: output/data/cox_model_summary_haemonc_standinflix.dta

  run_cox_models_standvedolizumab:
    run: stata-mp:latest analysis/202_cox_models.do "standvedolizumab"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_standvedolizumab.smcl 
        data1: output/data/cox_model_summary_standvedolizumab.dta
        data2: output/data/cox_model_summary_haemonc_standvedolizumab.dta

  run_cox_models_standabatacept:
    run: stata-mp:latest analysis/202_cox_models.do "standabatacept"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_standabatacept.smcl 
        data1: output/data/cox_model_summary_standabatacept.dta
        data2: output/data/cox_model_summary_haemonc_standabatacept.dta
        
  run_cox_models_imid_ethnicity_1:
    run: stata-mp:latest analysis/500_cox_models_ethnic.do "imid" "1"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_imid_ethnicity_1.smcl 
        data1: output/data/cox_model_summary_imid_ethnicity_1.dta
        data2: output/data/cox_model_summary_haemonc_imid_ethnicity_1.dta

  run_cox_models_imid_ethnicity_2:
    run: stata-mp:latest analysis/500_cox_models_ethnic.do "imid" "2"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_imid_ethnicity_2.smcl 
        data1: output/data/cox_model_summary_imid_ethnicity_2.dta
        data2: output/data/cox_model_summary_haemonc_imid_ethnicity_2.dta

  run_cox_models_imid_ethnicity_3:
    run: stata-mp:latest analysis/500_cox_models_ethnic.do "imid" "3"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_imid_ethnicity_3.smcl 
        data1: output/data/cox_model_summary_imid_ethnicity_3.dta
        data2: output/data/cox_model_summary_haemonc_imid_ethnicity_3.dta

  run_cox_models_imid_ethnicity_4:
    run: stata-mp:latest analysis/500_cox_models_ethnic.do "imid" "4"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_imid_ethnicity_4.smcl 
        data1: output/data/cox_model_summary_imid_ethnicity_4.dta
        data2: output/data/cox_model_summary_haemonc_imid_ethnicity_4.dta

  run_cox_models_imid_ethnicity_5:
    run: stata-mp:latest analysis/500_cox_models_ethnic.do "imid" "5"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_imid_ethnicity_5.smcl 
        data1: output/data/cox_model_summary_imid_ethnicity_5.dta
        data2: output/data/cox_model_summary_haemonc_imid_ethnicity_5.dta

  run_cox_models_imid_ethnicity_u:
    run: stata-mp:latest analysis/500_cox_models_ethnic.do "imid" "u"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_imid_ethnicity_u.smcl 
        data1: output/data/cox_model_summary_imid_ethnicity_u.dta
        data2: output/data/cox_model_summary_haemonc_imid_ethnicity_u.dta

  run_cox_models_joint_ethnicity_1:
    run: stata-mp:latest analysis/500_cox_models_ethnic.do "joint" "1"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_joint_ethnicity_1.smcl 
        data1: output/data/cox_model_summary_joint_ethnicity_1.dta
        data2: output/data/cox_model_summary_haemonc_joint_ethnicity_1.dta

  run_cox_models_joint_ethnicity_2:
    run: stata-mp:latest analysis/500_cox_models_ethnic.do "joint" "2"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_joint_ethnicity_2.smcl 
        data1: output/data/cox_model_summary_joint_ethnicity_2.dta
        data2: output/data/cox_model_summary_haemonc_joint_ethnicity_2.dta

  run_cox_models_joint_ethnicity_3:
    run: stata-mp:latest analysis/500_cox_models_ethnic.do "joint" "3"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_joint_ethnicity_3.smcl 
        data1: output/data/cox_model_summary_joint_ethnicity_3.dta
        data2: output/data/cox_model_summary_haemonc_joint_ethnicity_3.dta

  run_cox_models_joint_ethnicity_4:
    run: stata-mp:latest analysis/500_cox_models_ethnic.do "joint" "4"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_joint_ethnicity_4.smcl 
        data1: output/data/cox_model_summary_joint_ethnicity_4.dta
        data2: output/data/cox_model_summary_haemonc_joint_ethnicity_4.dta

  run_cox_models_joint_ethnicity_5:
    run: stata-mp:latest analysis/500_cox_models_ethnic.do "joint" "5"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_joint_ethnicity_5.smcl 
        data1: output/data/cox_model_summary_joint_ethnicity_5.dta
        data2: output/data/cox_model_summary_haemonc_joint_ethnicity_5.dta

  run_cox_models_joint_ethnicity_u:
    run: stata-mp:latest analysis/500_cox_models_ethnic.do "joint" "u"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_joint_ethnicity_u.smcl 
        data1: output/data/cox_model_summary_joint_ethnicity_u.dta
        data2: output/data/cox_model_summary_haemonc_joint_ethnicity_u.dta

  run_cox_models_skin_ethnicity_1:
    run: stata-mp:latest analysis/500_cox_models_ethnic.do "skin" "1"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_skin_ethnicity_1.smcl 
        data1: output/data/cox_model_summary_skin_ethnicity_1.dta
        data2: output/data/cox_model_summary_haemonc_skin_ethnicity_1.dta

  run_cox_models_skin_ethnicity_2:
    run: stata-mp:latest analysis/500_cox_models_ethnic.do "skin" "2"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_skin_ethnicity_2.smcl 
        data1: output/data/cox_model_summary_skin_ethnicity_2.dta
        data2: output/data/cox_model_summary_haemonc_skin_ethnicity_2.dta

  run_cox_models_skin_ethnicity_3:
    run: stata-mp:latest analysis/500_cox_models_ethnic.do "skin" "3"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_skin_ethnicity_3.smcl 
        data1: output/data/cox_model_summary_skin_ethnicity_3.dta
        data2: output/data/cox_model_summary_haemonc_skin_ethnicity_3.dta

  run_cox_models_skin_ethnicity_4:
    run: stata-mp:latest analysis/500_cox_models_ethnic.do "skin" "4"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_skin_ethnicity_4.smcl 
        data1: output/data/cox_model_summary_skin_ethnicity_4.dta
        data2: output/data/cox_model_summary_haemonc_skin_ethnicity_4.dta

  run_cox_models_skin_ethnicity_5:
    run: stata-mp:latest analysis/500_cox_models_ethnic.do "skin" "5"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_skin_ethnicity_5.smcl 
        data1: output/data/cox_model_summary_skin_ethnicity_5.dta
        data2: output/data/cox_model_summary_haemonc_skin_ethnicity_5.dta

  run_cox_models_skin_ethnicity_u:
    run: stata-mp:latest analysis/500_cox_models_ethnic.do "skin" "u"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_skin_ethnicity_u.smcl 
        data1: output/data/cox_model_summary_skin_ethnicity_u.dta
        data2: output/data/cox_model_summary_haemonc_skin_ethnicity_u.dta

  run_cox_models_bowel_ethnicity_1:
    run: stata-mp:latest analysis/500_cox_models_ethnic.do "bowel" "1"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_bowel_ethnicity_1.smcl 
        data1: output/data/cox_model_summary_bowel_ethnicity_1.dta
        data2: output/data/cox_model_summary_haemonc_bowel_ethnicity_1.dta

  run_cox_models_bowel_ethnicity_2:
    run: stata-mp:latest analysis/500_cox_models_ethnic.do "bowel" "2"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_bowel_ethnicity_2.smcl 
        data1: output/data/cox_model_summary_bowel_ethnicity_2.dta
        data2: output/data/cox_model_summary_haemonc_bowel_ethnicity_2.dta

  run_cox_models_bowel_ethnicity_3:
    run: stata-mp:latest analysis/500_cox_models_ethnic.do "bowel" "3"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_bowel_ethnicity_3.smcl 
        data1: output/data/cox_model_summary_bowel_ethnicity_3.dta
        data2: output/data/cox_model_summary_haemonc_bowel_ethnicity_3.dta

  run_cox_models_bowel_ethnicity_4:
    run: stata-mp:latest analysis/500_cox_models_ethnic.do "bowel" "4"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_bowel_ethnicity_4.smcl 
        data1: output/data/cox_model_summary_bowel_ethnicity_4.dta
        data2: output/data/cox_model_summary_haemonc_bowel_ethnicity_4.dta

  run_cox_models_bowel_ethnicity_5:
    run: stata-mp:latest analysis/500_cox_models_ethnic.do "bowel" "5"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_bowel_ethnicity_5.smcl 
        data1: output/data/cox_model_summary_bowel_ethnicity_5.dta
        data2: output/data/cox_model_summary_haemonc_bowel_ethnicity_5.dta

  run_cox_models_bowel_ethnicity_u:
    run: stata-mp:latest analysis/500_cox_models_ethnic.do "bowel" "u"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_bowel_ethnicity_u.smcl 
        data1: output/data/cox_model_summary_bowel_ethnicity_u.dta
        data2: output/data/cox_model_summary_haemonc_bowel_ethnicity_u.dta

  run_cox_models_genpop_ethnicity_vs_white:
    run: stata-mp:latest analysis/501_cox_models_per_imid.do "genpop"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_genpop_ethnicity_vs_white.smcl 
        data1: output/data/cox_model_summary_genpop_ethnicity_vs_white.dta

  run_cox_models_imid_ethnicity_vs_white:
    run: stata-mp:latest analysis/501_cox_models_per_imid.do "imid"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_imid_ethnicity_vs_white.smcl 
        data1: output/data/cox_model_summary_imid_ethnicity_vs_white.dta

  run_cox_models_joint_ethnicity_vs_white:
    run: stata-mp:latest analysis/501_cox_models_per_imid.do "joint"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_joint_ethnicity_vs_white.smcl 
        data1: output/data/cox_model_summary_joint_ethnicity_vs_white.dta

  run_cox_models_skin_ethnicity_vs_white:
    run: stata-mp:latest analysis/501_cox_models_per_imid.do "skin"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_skin_ethnicity_vs_white.smcl 
        data1: output/data/cox_model_summary_skin_vs_white.dta

  run_cox_models_bowel_ethnicity_vs_white:
    run: stata-mp:latest analysis/501_cox_models_per_imid.do "bowel"
    needs: [create_cohorts_single_file]
    outputs:
      moderately_sensitive:
        log1: logs/cox_models_bowel_ethnicity_vs_white.smcl 
        data1: output/data/cox_model_summary_bowel_ethnicity_vs_white.dta

  run_survival_curves:
    run: stata-mp:latest analysis/301_survival_curves.do
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/graphs.smcl 
        survcur_bowel_died: output/figures/survcur_bowel_died.svg
        survcur_bowel_hospital: output/figures/survcur_bowel_hospital.svg
        survcur_bowel_icuordeath: output/figures/survcur_bowel_icuordeath.svg
        survcur_imid_died: output/figures/survcur_imid_died.svg
        survcur_imid_hospital: output/figures/survcur_imid_hospital.svg
        survcur_imid_icuordeath: output/figures/survcur_imid_icuordeath.svg
        survcur_imiddrugcategory_died: output/figures/survcur_imiddrugcategory_died.svg
        survcur_imiddrugcategory_hospital: output/figures/survcur_imiddrugcategory_hospital.svg
        survcur_imiddrugcategory_icuordeath: output/figures/survcur_imiddrugcategory_icuordeath.svg
        survcur_joint_died: output/figures/survcur_joint_died.svg
        survcur_joint_hospital: output/figures/survcur_joint_hospital.svg
        survcur_joint_icuordeath: output/figures/survcur_joint_icuordeath.svg
        survcur_skin_died: output/figures/survcur_skin_died.svg
        survcur_skin_hospital: output/figures/survcur_skin_hospital.svg
        survcur_skin_icuordeath: output/figures/survcur_skin_icuordeath.svg
        survhaz_bowel_died: output/figures/survhaz_bowel_died.svg
        survhaz_bowel_hospital: output/figures/survhaz_bowel_hospital.svg
        survhaz_bowel_icuordeath: output/figures/survhaz_bowel_icuordeath.svg
        survhaz_imid_died: output/figures/survhaz_imid_died.svg
        survhaz_imid_hospital: output/figures/survhaz_imid_hospital.svg
        survhaz_imid_icuordeath: output/figures/survhaz_imid_icuordeath.svg
        survhaz_imiddrugcategory_died: output/figures/survhaz_imiddrugcategory_died.svg
        survhaz_imiddrugcategory_hospital: output/figures/survhaz_imiddrugcategory_hospital.svg
        survhaz_imiddrugcategory_icuordeath: output/figures/survhaz_imiddrugcategory_icuordeath.svg
        survhaz_joint_died: output/figures/survhaz_joint_died.svg
        survhaz_joint_hospital: output/figures/survhaz_joint_hospital.svg
        survhaz_joint_icuordeath: output/figures/survhaz_joint_icuordeath.svg
        survhaz_skin_died: output/figures/survhaz_skin_died.svg
        survhaz_skin_hospital: output/figures/survhaz_skin_hospital.svg
        survhaz_skin_icuordeath: output/figures/survhaz_skin_icuordeath.svg
        survrisk_bowel_died: output/figures/survrisk_bowel_died.svg
        survrisk_bowel_hospital: output/figures/survrisk_bowel_hospital.svg
        survrisk_bowel_icuordeath: output/figures/survrisk_bowel_icuordeath.svg
        survrisk_imid_died: output/figures/survrisk_imid_died.svg
        survrisk_imid_hospital: output/figures/survrisk_imid_hospital.svg
        survrisk_imid_icuordeath: output/figures/survrisk_imid_icuordeath.svg
        survrisk_imiddrugcategory_died: output/figures/survrisk_imiddrugcategory_died.svg
        survrisk_imiddrugcategory_hospital: output/figures/survrisk_imiddrugcategory_hospital.svg
        survrisk_imiddrugcategory_icuordeath: output/figures/survrisk_imiddrugcategory_icuordeath.svg
        survrisk_joint_died: output/figures/survrisk_joint_died.svg
        survrisk_joint_hospital: output/figures/survrisk_joint_hospital.svg
        survrisk_joint_icuordeath: output/figures/survrisk_joint_icuordeath.svg
        survrisk_skin_died: output/figures/survrisk_skin_died.svg
        survrisk_skin_hospital: output/figures/survrisk_skin_hospital.svg
        survrisk_skin_icuordeath: output/figures/survrisk_skin_icuordeath.svg

  run_cox_spline_imid:
    run: stata-mp:latest analysis/402_cox_models_agespline.do "imid"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_spline_imid.smcl 
        data1: output/data/cox_spline_summary_imid.dta
        data2: output/data/cox_spline_summary_haemonc_imid.dta
        
  run_cox_spline_joint:
    run: stata-mp:latest analysis/402_cox_models_agespline.do "joint"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_spline_joint.smcl 
        data1: output/data/cox_spline_summary_joint.dta
        data2: output/data/cox_spline_summary_haemonc_joint.dta

  run_cox_spline_skin:
    run: stata-mp:latest analysis/402_cox_models_agespline.do "skin"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_spline_skin.smcl 
        data1: output/data/cox_spline_summary_skin.dta
        data2: output/data/cox_spline_summary_haemonc_skin.dta
 
  run_cox_spline_bowel:
    run: stata-mp:latest analysis/402_cox_models_agespline.do "bowel"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_spline_bowel.smcl 
        data1: output/data/cox_spline_summary_bowel.dta
        data2: output/data/cox_spline_summary_haemonc_bowel.dta
 
  run_cox_spline_imiddrugcategory:
    run: stata-mp:latest analysis/402_cox_models_agespline.do "imiddrugcategory"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_spline_imiddrugcategory.smcl 
        data1: output/data/cox_spline_summary_imiddrugcategory.dta
        data2: output/data/cox_spline_summary_haemonc_imiddrugcategory.dta
  
  run_cox_spline_standtnf:
    run: stata-mp:latest analysis/402_cox_models_agespline.do "standtnf"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_spline_standtnf.smcl 
        data1: output/data/cox_spline_summary_standtnf.dta
        data2: output/data/cox_spline_summary_haemonc_standtnf.dta

  run_cox_spline_standtnf3m:
    run: stata-mp:latest analysis/402_cox_models_agespline.do "standtnf3m"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_spline_standtnf3m.smcl 
        data1: output/data/cox_spline_summary_standtnf3m.dta
        data2: output/data/cox_spline_summary_haemonc_standtnf3m.dta
       
  run_cox_spline_tnfmono:
    run: stata-mp:latest analysis/402_cox_models_agespline.do "tnfmono"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_spline_tnfmono.smcl 
        data1: output/data/cox_spline_summary_tnfmono.dta
        data2: output/data/cox_spline_summary_haemonc_tnfmono.dta
  
  run_cox_spline_standil6:
    run: stata-mp:latest analysis/402_cox_models_agespline.do "standil6"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_spline_standil6.smcl 
        data1: output/data/cox_spline_summary_standil6.dta
        data2: output/data/cox_spline_summary_haemonc_standil6.dta
  
  run_cox_spline_standil17:
    run: stata-mp:latest analysis/402_cox_models_agespline.do "standil17"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_spline_standil17.smcl 
        data1: output/data/cox_spline_summary_standil17.dta
        data2: output/data/cox_spline_summary_haemonc_standil17.dta
 
  run_cox_spline_standil23:
    run: stata-mp:latest analysis/402_cox_models_agespline.do "standil23"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_spline_standil23.smcl 
        data1: output/data/cox_spline_summary_standil23.dta
        data2: output/data/cox_spline_summary_haemonc_standil23.dta
 
  run_cox_spline_standjaki:
    run: stata-mp:latest analysis/402_cox_models_agespline.do "standjaki"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_spline_standjaki.smcl 
        data1: output/data/cox_spline_summary_standjaki.dta
        data2: output/data/cox_spline_summary_haemonc_standjaki.dta
  
  run_cox_spline_standritux:
    run: stata-mp:latest analysis/402_cox_models_agespline.do "standritux"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_spline_standritux.smcl 
        data1: output/data/cox_spline_summary_standritux.dta
        data2: output/data/cox_spline_summary_haemonc_standritux.dta
        
  run_cox_spline_standinflix:
    run: stata-mp:latest analysis/402_cox_models_agespline.do "standinflix"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_spline_standinflix.smcl 
        data1: output/data/cox_spline_summary_standinflix.dta
        data2: output/data/cox_spline_summary_haemonc_standinflix.dta

  run_cox_spline_standvedolizumab:
    run: stata-mp:latest analysis/402_cox_models_agespline.do "standvedolizumab"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_spline_standvedolizumab.smcl 
        data1: output/data/cox_spline_summary_standvedolizumab.dta
        data2: output/data/cox_spline_summary_haemonc_standvedolizumab.dta

  run_cox_spline_standabatacept:
    run: stata-mp:latest analysis/402_cox_models_agespline.do "standabatacept"
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        log1: logs/cox_spline_standabatacept.smcl 
        data1: output/data/cox_spline_summary_standabatacept.dta
        data2: output/data/cox_spline_summary_haemonc_standabatacept.dta

  run_spline_export_csv:
    run: stata-mp:latest analysis/403_spline_export_csv.do
    needs: [run_cox_spline_imid,run_cox_spline_joint,run_cox_spline_bowel,run_cox_spline_skin,run_cox_spline_imiddrugcategory,run_cox_spline_standtnf,run_cox_spline_standtnf3m,run_cox_spline_standil6,run_cox_spline_standil17,run_cox_spline_standil23,run_cox_spline_standritux,run_cox_spline_standinflix,run_cox_spline_tnfmono,run_cox_spline_standjaki,run_cox_spline_standvedolizumab,run_cox_spline_standabatacept]
    outputs:
      moderately_sensitive:
        log: logs/spline_export_csv.smcl
        csv_spline_spline_imid: output/data/csv_spline_imid.csv
        csvhaemonc_spline_imid: output/data/csvhaemonc_spline_imid.csv
        csv_spline_joint: output/data/csv_spline_joint.csv
        csvhaemonc_spline_joint: output/data/csvhaemonc_spline_joint.csv
        csv_spline_skin: output/data/csv_spline_skin.csv
        csvhaemonc_spline_skin: output/data/csvhaemonc_spline_skin.csv
        csv_spline_bowel: output/data/csv_spline_bowel.csv
        csvhaemonc_spline_bowel: output/data/csvhaemonc_spline_bowel.csv
        csv_spline_imiddrugcategory: output/data/csv_spline_imiddrugcategory.csv
        csvhaemonc_spline_imiddrugcategory: output/data/csvhaemonc_spline_imiddrugcategory.csv
        csv_spline_standtnf: output/data/csv_spline_standtnf.csv
        csvhaemonc_spline_standtnf: output/data/csvhaemonc_spline_standtnf.csv
        csv_spline_standtnf3m: output/data/csv_spline_standtnf3m.csv
        csvhaemonc_spline_standtnf3m: output/data/csvhaemonc_spline_standtnf3m.csv
        csv_spline_tnfmono: output/data/csv_spline_tnfmono.csv
        csvhaemonc_spline_tnfmono: output/data/csvhaemonc_spline_tnfmono.csv
        csv_spline_standil6: output/data/csv_spline_standil6.csv
        csvhaemonc_spline_standil6: output/data/csvhaemonc_spline_standil6.csv
        csv_spline_standil17: output/data/csv_spline_standil17.csv
        csvhaemonc_spline_standil17: output/data/csvhaemonc_spline_standil17.csv
        csv_spline_standil23: output/data/csv_spline_standil23.csv
        csvhaemonc_spline_standil23: output/data/csvhaemonc_spline_standil23.csv
        csv_spline_standjaki: output/data/csv_spline_standjaki.csv
        csvhaemonc_spline_standjaki: output/data/csvhaemonc_spline_standjaki.csv
        csv_spline_standritux: output/data/csv_spline_standritux.csv
        csvhaemonc_spline_standritux: output/data/csvhaemonc_spline_standritux.csv
        csv_spline_standinflix: output/data/csv_spline_standinflix.csv
        csvhaemonc_spline_standinflix: output/data/csvhaemonc_spline_standinflix.csv
        csv_spline_standvedolizumab: output/data/csv_spline_standvedolizumab.csv
        csvhaemonc_spline_standvedolizumab: output/data/csvhaemonc_spline_standvedolizumab.csv
        csv_spline_standabatacept: output/data/csv_spline_standabatacept.csv
        csvhaemonc_spline_standabatacept: output/data/csvhaemonc_spline_standabatacept.csv

  run_schoenfeld:
    run: stata-mp:latest analysis/401_schoenfeld.do
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        logschoenfeld: logs/cox_model_diagnostics.smcl

  run_outcomes_check:
    run: r:latest analysis/outcomes_check_withandwithoutpositivetest.R
    needs: [create_cohorts]
    outputs:
      moderately_sensitive:
        data1: output/data/outcomes_check.csv
  
  run_export_csv:
    run: stata-mp:latest analysis/400_export_csv.do
    needs: [run_cox_models_imid,run_cox_models_joint,run_cox_models_skin,run_cox_models_bowel,run_cox_models_imiddrugcategory,run_cox_models_standtnf,run_cox_models_standtnf3m,run_cox_models_tnfmono,run_cox_models_standil6,run_cox_models_standil17,run_cox_models_standil23,run_cox_models_standjaki,run_cox_models_standritux,run_cox_models_standinflix,run_cox_models_standvedolizumab,run_cox_models_standabatacept]
    outputs:
      moderately_sensitive:
        log: logs/export_csv.smcl
        csv_imid: output/data/csv_imid.csv
        csvhaemonc_imid: output/data/csvhaemonc_imid.csv
        csv_joint: output/data/csv_joint.csv
        csvhaemonc_joint: output/data/csvhaemonc_joint.csv
        csv_skin: output/data/csv_skin.csv
        csvhaemonc_skin: output/data/csvhaemonc_skin.csv
        csv_bowel: output/data/csv_bowel.csv
        csvhaemonc_bowel: output/data/csvhaemonc_bowel.csv
        csv_imiddrugcategory: output/data/csv_imiddrugcategory.csv
        csvhaemonc_imiddrugcategory: output/data/csvhaemonc_imiddrugcategory.csv
        csv_standtnf: output/data/csv_standtnf.csv
        csvhaemonc_standtnf: output/data/csvhaemonc_standtnf.csv
        csv_standtnf3m: output/data/csv_standtnf3m.csv
        csvhaemonc_standtnf3m: output/data/csvhaemonc_standtnf3m.csv
        csv_tnfmono: output/data/csv_tnfmono.csv
        csvhaemonc_tnfmono: output/data/csvhaemonc_tnfmono.csv
        csv_standil6: output/data/csv_standil6.csv
        csvhaemonc_standil6: output/data/csvhaemonc_standil6.csv
        csv_standil17: output/data/csv_standil17.csv
        csvhaemonc_standil17: output/data/csvhaemonc_standil17.csv
        csv_standil23: output/data/csv_standil23.csv
        csvhaemonc_standil23: output/data/csvhaemonc_standil23.csv
        csv_standjaki: output/data/csv_standjaki.csv
        csvhaemonc_standjaki: output/data/csvhaemonc_standjaki.csv
        csv_standritux: output/data/csv_standritux.csv
        csvhaemonc_standritux: output/data/csvhaemonc_standritux.csv
        csv_standinflix: output/data/csv_standinflix.csv
        csvhaemonc_standinflix: output/data/csvhaemonc_standinflix.csv
        csv_standvedolizumab: output/data/csv_standvedolizumab.csv
        csvhaemonc_standvedolizumab: output/data/csvhaemonc_standvedolizumab.csv
        csv_standabatacept: output/data/csv_standabatacept.csv
        csvhaemonc_standabatacept: output/data/csvhaemonc_standabatacept.csv

  run_forest_plots:
    run: r:latest analysis/r-immunosuppressant-meds-research/make_forest_plots_with_3_models.R
    needs: [run_export_csv]
    outputs:
      moderately_sensitive:
        merged_csv: output/data/merged_csv_normal.csv
        merged_csv_haemoonc: output/data/merged_csv_haemonc.csv
        forest_plot_vs_gen_pop: output/figures/forest_plot_vs_gen_pop.svg
        forest_plot_vs_standard_systemic: output/figures/forest_plot_vs_standard_systemic.svg

  run_export_csv_ethnicity:
    run: stata-mp:latest analysis/600_export_csv_ethnicity.do
    needs: [run_cox_models_imid_ethnicity_1,run_cox_models_imid_ethnicity_2,run_cox_models_imid_ethnicity_3,run_cox_models_imid_ethnicity_4,run_cox_models_imid_ethnicity_5,run_cox_models_imid_ethnicity_u,run_cox_models_joint_ethnicity_1,run_cox_models_joint_ethnicity_2,run_cox_models_joint_ethnicity_3,run_cox_models_joint_ethnicity_4,run_cox_models_joint_ethnicity_5,run_cox_models_joint_ethnicity_u,run_cox_models_skin_ethnicity_1,run_cox_models_skin_ethnicity_2,run_cox_models_skin_ethnicity_3,run_cox_models_skin_ethnicity_4,run_cox_models_skin_ethnicity_5,run_cox_models_skin_ethnicity_u,run_cox_models_bowel_ethnicity_1,run_cox_models_bowel_ethnicity_2,run_cox_models_bowel_ethnicity_3,run_cox_models_bowel_ethnicity_4,run_cox_models_bowel_ethnicity_5,run_cox_models_bowel_ethnicity_u]
    outputs:
      moderately_sensitive:
        log: logs/export_csv_ethnicity.smcl
        csv_imid_ethnicity_1_csv:  output/data/csv_imid_ethnicity_1.csv
        csv_imid_ethnicity_2_csv:  output/data/csv_imid_ethnicity_2.csv
        csv_imid_ethnicity_3_csv:  output/data/csv_imid_ethnicity_3.csv
        csv_imid_ethnicity_4_csv:  output/data/csv_imid_ethnicity_4.csv
        csv_imid_ethnicity_5_csv:  output/data/csv_imid_ethnicity_5.csv
        csv_imid_ethnicity_u_csv:  output/data/csv_imid_ethnicity_u.csv
        csv_joint_ethnicity_1_csv: output/data/csv_joint_ethnicity_1.csv
        csv_joint_ethnicity_2_csv: output/data/csv_joint_ethnicity_2.csv
        csv_joint_ethnicity_3_csv: output/data/csv_joint_ethnicity_3.csv
        csv_joint_ethnicity_4_csv: output/data/csv_joint_ethnicity_4.csv
        csv_joint_ethnicity_5_csv: output/data/csv_joint_ethnicity_5.csv
        csv_joint_ethnicity_u_csv: output/data/csv_joint_ethnicity_u.csv
        csv_skin_ethnicity_1_csv:  output/data/csv_skin_ethnicity_1.csv
        csv_skin_ethnicity_2_csv:  output/data/csv_skin_ethnicity_2.csv
        csv_skin_ethnicity_3_csv:  output/data/csv_skin_ethnicity_3.csv
        csv_skin_ethnicity_4_csv:  output/data/csv_skin_ethnicity_4.csv
        csv_skin_ethnicity_5_csv:  output/data/csv_skin_ethnicity_5.csv
        csv_skin_ethnicity_u_csv:  output/data/csv_skin_ethnicity_u.csv
        csv_bowel_ethnicity_1_csv: output/data/csv_bowel_ethnicity_1.csv
        csv_bowel_ethnicity_2_csv: output/data/csv_bowel_ethnicity_2.csv
        csv_bowel_ethnicity_3_csv: output/data/csv_bowel_ethnicity_3.csv
        csv_bowel_ethnicity_4_csv: output/data/csv_bowel_ethnicity_4.csv
        csv_bowel_ethnicity_5_csv: output/data/csv_bowel_ethnicity_5.csv
        csv_bowel_ethnicity_u_csv: output/data/csv_bowel_ethnicity_u.csv
        csvhaemonc_imid_ethnicity_1_csv:  output/data/csvhaemonc_imid_ethnicity_1.csv
        csvhaemonc_imid_ethnicity_2_csv:  output/data/csvhaemonc_imid_ethnicity_2.csv
        csvhaemonc_imid_ethnicity_3_csv:  output/data/csvhaemonc_imid_ethnicity_3.csv
        csvhaemonc_imid_ethnicity_4_csv:  output/data/csvhaemonc_imid_ethnicity_4.csv
        csvhaemonc_imid_ethnicity_5_csv:  output/data/csvhaemonc_imid_ethnicity_5.csv
        csvhaemonc_imid_ethnicity_u_csv:  output/data/csvhaemonc_imid_ethnicity_u.csv
        csvhaemonc_joint_ethnicity_1_csv: output/data/csvhaemonc_joint_ethnicity_1.csv
        csvhaemonc_joint_ethnicity_2_csv: output/data/csvhaemonc_joint_ethnicity_2.csv
        csvhaemonc_joint_ethnicity_3_csv: output/data/csvhaemonc_joint_ethnicity_3.csv
        csvhaemonc_joint_ethnicity_4_csv: output/data/csvhaemonc_joint_ethnicity_4.csv
        csvhaemonc_joint_ethnicity_5_csv: output/data/csvhaemonc_joint_ethnicity_5.csv
        csvhaemonc_joint_ethnicity_u_csv: output/data/csvhaemonc_joint_ethnicity_u.csv
        csvhaemonc_skin_ethnicity_1_csv:  output/data/csvhaemonc_skin_ethnicity_1.csv
        csvhaemonc_skin_ethnicity_2_csv:  output/data/csvhaemonc_skin_ethnicity_2.csv
        csvhaemonc_skin_ethnicity_3_csv:  output/data/csvhaemonc_skin_ethnicity_3.csv
        csvhaemonc_skin_ethnicity_4_csv:  output/data/csvhaemonc_skin_ethnicity_4.csv
        csvhaemonc_skin_ethnicity_5_csv:  output/data/csvhaemonc_skin_ethnicity_5.csv
        csvhaemonc_skin_ethnicity_u_csv:  output/data/csvhaemonc_skin_ethnicity_u.csv
        csvhaemonc_bowel_ethnicity_1_csv: output/data/csvhaemonc_bowel_ethnicity_1.csv
        csvhaemonc_bowel_ethnicity_2_csv: output/data/csvhaemonc_bowel_ethnicity_2.csv
        csvhaemonc_bowel_ethnicity_3_csv: output/data/csvhaemonc_bowel_ethnicity_3.csv
        csvhaemonc_bowel_ethnicity_4_csv: output/data/csvhaemonc_bowel_ethnicity_4.csv
        csvhaemonc_bowel_ethnicity_5_csv: output/data/csvhaemonc_bowel_ethnicity_5.csv
        csvhaemonc_bowel_ethnicity_u_csv: output/data/csvhaemonc_bowel_ethnicity_u.csv

  run_forest_plots_ethnicity:
    run: r:latest analysis/r-immunosuppressant-meds-research/make_forest_plots_with_3_models_ethnicity.R
    needs: [run_export_csv_ethnicity]
    outputs:
      moderately_sensitive:
        merged_csv_ethnicity: output/data/merged_csv_normal_ethnicity.csv
        merged_csv_haemoonc_ethnicity: output/data/merged_csv_haemonc_ethnicity.csv
        model_data_ethnicity: output/data/model_data_ethnicity.csv
        forest_plot_vs_gen_pop_ethnicity_1: output/figures/forest_plot_vs_gen_pop_ethnicity_1.svg
        forest_plot_vs_gen_pop_ethnicity_2: output/figures/forest_plot_vs_gen_pop_ethnicity_2.svg
        forest_plot_vs_gen_pop_ethnicity_3: output/figures/forest_plot_vs_gen_pop_ethnicity_3.svg
        forest_plot_vs_gen_pop_ethnicity_4: output/figures/forest_plot_vs_gen_pop_ethnicity_4.svg
        forest_plot_vs_gen_pop_ethnicity_5: output/figures/forest_plot_vs_gen_pop_ethnicity_5.svg
        forest_plot_vs_gen_pop_ethnicity_u: output/figures/forest_plot_vs_gen_pop_ethnicity_u.svg
        forest_plot_vs_gen_pop_ethnicity_died: output/figures/forest_plot_vs_gen_pop_ethnicity_died.svg
        forest_plot_vs_gen_pop_ethnicity_hospital: output/figures/forest_plot_vs_gen_pop_ethnicity_hospital.svg
        forest_plot_vs_gen_pop_ethnicity_icuordeath: output/figures/forest_plot_vs_gen_pop_ethnicity_icuordeath.svg

  run_merge_csvs_spline:
    run: r:latest analysis/r-immunosuppressant-meds-research/merge_csvs_spline.R
    needs: [run_spline_export_csv]
    outputs:
      moderately_sensitive:
        merged_csv_splline: output/data/merged_csv_normal_spline.csv
        merged_csv_spline_haemonc: output/data/merged_csv_haemonc_spline.csv

  run_extract_n_subjects:
    run: r:latest analysis/r-immunosuppressant-meds-research/extract_n_subjects.R
    needs: [run_cox_models_imid,run_cox_models_joint,run_cox_models_bowel,run_cox_models_skin,run_cox_models_imiddrugcategory,run_cox_models_standtnf,run_cox_models_standtnf3m,run_cox_models_tnfmono,run_cox_models_standil6,run_cox_models_standil17,run_cox_models_standil23,run_cox_models_standjaki,run_cox_models_standritux,run_cox_models_standinflix,run_cox_models_standvedolizumab,run_cox_models_standabatacept]
    outputs:
      moderately_sensitive:
        merged_csv: output/data/subject_numbers.csv
